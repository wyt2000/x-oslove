---
export_on_save:
  html: true
presentation:
  mouseWheel: true
  width: 1000
  height: 1000
---
<!-- slide -->

# 实时文本协作插件
## colive 

吴钰同 黄炜喆 李钰铭 明宇龙

<!-- slide -->
## 项目简介
使用 TypeScript 实现基于 CRDT 的 LaTeX 实时协作编辑系统，编写成符合 LSP 协议的插件，并使之能在 VSCode 等 IDE 上使用。

<!-- slide -->
## 项目简介
- TypeScript：JavaScript 的超集，主要区别是提供了静态类型注解，解决了 JavaScript 动态类型带来的问题。 微软官方建议 VSCode 插件开发时使用 TypeScript 。
- CRDT：无冲突可复制数据类型，用于解决在分布式系统中并发修改造成的各个客户端结果不一致的问题。由于实现功能完备的 CRDT 工作量过大，而且在 2018 年的大作业中已经有实现了，我们决定使用成熟的 CRDT 库 Automerge 。

<!-- slide -->
## 项目简介
- Language Server ：微软提出的一种 IDE 插件开发机制。将插件对文本的操作从插件本身分离出来，放到一个独立的 Language Server 进程里，用于实现跨 IDE 的插件开发。
- LaTeX ：本项目与文本类型无关，LaTex 只是作为一个示例。
- 服务端：使用 flask-socketIO 进行文本内容的传输。当客户端不在同一个子网时，以一台阿里云服务器作为中心节点进行广播；当客户端位于同一子网时，通过中间件直接在客户端之间广播。

<!-- slide -->
## 设计思路
首先我们调研了 2018 年的 OSH 大作业：基于 CRDT 的多人实时协作编辑器，发现他们存在如下问题：
- 只能支持单个字符的插入和删除，不能支持以字符串为单位的剪切、粘贴等操作。
- 不能支持撤销与重做。
- 依托于网页端的代码编辑器 CodeMirror ，文本格式单一，限制较多。

经过组内讨论，我们决定实现一个能够解决上述问题的 VSCode 实时协作编辑插件。

<!-- slide -->
## 设计思路
充分调研 CRDT 数据结构后，我们发现其实现难度远超我们现在的能力水平，而且自己实现的 CRDT 效果不一定很好，所以我们决定直接使用 GitHub 上的开源 CRDT 库 Automerge 。

![Automerge](pics/sign.svg)

<!-- slide -->
## `Automerge`
- Automerge 采用经典的 CRDT 实现，它定义了一套的操作，这些操作可用于查询和修改本地文档。

- 当命令改变文档的状态时，它们生成描述这种变化的操作。然后，该操作立即应用于副本，以便在本地生效，并且该操作也被异步地广播到其他副本。在从远程副本接收到操作后，当满足其特定依赖关系时，将在本地应用该操作。

- 操作的执行顺序通过 Lamport 时间戳确定。

- 复制粘贴等操作的实现，是由其定义的原子操作粒度和对应操作的算法决定的。

<!-- slide -->
## `Automerge`
Automerge 实现了可以自动合并并发操作的 JavaScript 数据结构，其接口类似于 git ，但与 git 不同的是，并发操作不需要手动 merge ，而是可以自动合并。

<!-- slide -->
## `Automerge`
Automerge 的实现与网络无关，可以很好适配 socketIO
```javascript
// On one node
newDoc = Automerge.change(currentDoc, doc => {
  // make arbitrary change to the document
})
let changes = Automerge.getChanges(currentDoc, newDoc)
network.broadcast(JSON.stringify(changes))

// On another node
let changes = JSON.parse(network.receive())
newDoc = Automerge.applyChanges(currentDoc, changes)
```
- Automerge is a pure data structure library that does not care about what kind of network you use: client/server, peer-to-peer, Bluetooth, USB drive in the mail, whatever, anything goes.


<!-- slide -->
## `Automerge`
- Automerge 虽然自带了 undo 和 redo ，但经它们的行为和预期不同，不过好在 Automerge 记录了操作历史，所以我们可以自己改写它的 undo 和 redo 方法。

- 我们自己编写了一个命令行工具来验证 Automerge 的正确性。

<!-- slide -->
## 设计思路
VSCode 提供了一些 API 来帮助插件获取工作区的文本变化，修改工作区的文本内容，以及进行插件本身和语言服务器之间的通信。

``` typescript
	vscode.workspace.onDidChangeTextDocument(changeEvent => {
    //...
    };
    connection.workspace.applyEdit(wse);
```
<!-- slide -->
## 具体实现
我们据此设计了一套文本变化接口：
```typescript
//extension.ts
interface ChangeIncident {
/*
* The operation of user: insert, delete, replace, redo, undo
* When multi-cursors are used, we consider them as different operation
*/
	operateType: string;
	text: string;
	from: { line: number, ch: number };
	to: { line: number, ch: number };
	rangeOffset: number;
	rangeLength: number;
}
```
- 当工作区文本发生变化时，触发 onDidChangeTextDocument ，在其回调中我们将 VSCode 的操作转化为 ChangeIncident ，然后发送给 language server 。

<!-- slide -->
## 具体实现
- 插件 (extension.ts) 把工作区的文本变化发送给 language server (server.ts) 。

- 当 language server 收到来自插件的变化时，更新 Automerge.doc 并将变化广播到其他客户端。

- 当 language server 接收到来自其他客户端的变化时，更新 doc 并将变化写回工作区。

- doc 的最终结果与上述操作的顺序无关。

<!-- slide -->
## 具体实现
在实现过程中，我们解决的问题如下：
- 工作区变化循环响应
- 登录登出机制
- 光标
- undo 与 redo
- 子网下客户端直连

<!-- slide -->
## 工作区变化循环响应
- VSCode 无法识别对工作区的修改来自用户还是插件本身，language server 的 applyEdit 也会触发 onDidChangeTextDocument ，这样会导致循环响应。

- 在 Github 上 VSCode 仓库的 issue (36939) 中我们查到 VSCode 官方拒绝提供判断工作区变化原因的 API 。

- 该开发者提出可以使用设置标记位的方法屏蔽掉修改。但 language server 对工作区的修改可能会和用户对工作区的修改是同时进行的，如果屏蔽掉 applyEdit 对 onDidChangeTextDocument 的触发，会同时屏蔽掉用户修改的发送。

- 我们曾考虑 applyEdit 的时候锁死工作区，但查阅 issue (4873) 后不幸地发现 VSCode 官方同样拒绝提供将工作区变成只读的 API 。
<!-- slide -->
## 工作区变化循环响应
- 最后我们发现，如果 language server 和用户同时对工作区做修改，会有一方的修改失效， language server 的修改失效可以通过 applyEdit 的回调参数判断，当出现上述情况时，我们将重新处理此次修改。

``` typescript
function applyEdit() {
	if (editFinished && wseQueue.length) {
		editFinished = false;
		connection.workspace.applyEdit(wseQueue[0]).then(response => {
			if (response.applied) {
				wseQueue.shift();
			}
			else {
				recvFromUser(lastChange);
			}
			editFinished = true;
			applyEdit();
			render();
		});
	}
}
```

<!-- slide -->
## 登录登出机制
- 18 年大作业中后登录的用户的工作区内容会被强制同步成前面用户的工作区内容，而我们采用的是在用户需要同步的时候通过 VSCode 左侧插件栏的按钮进行同步。
- 后登录的用户连接后，服务器会向第一个登录的用户 (admin) 发送同步请求，admin 收到请求后会将自己的 doc 发送到请求同步的用户处。
- 用户可以随时选择手动 disconnect ，disconnect 后用户的工作区将不再同步，他的光标也会在其他客户端消失，当所有用户登出时，服务器重新开始设置 userID 。
- socketIO 自带了长轮询机制，服务端每隔一段时间（可以在服务端设置）会向用户发送心跳包询问用户是否在线，如果没有应答则会触发 disconnect 。此机制解决了用户通过关掉 VSCode 窗口强制退出的问题。

<!-- slide -->
## 光标
- 18 年的大作业中没有显示各个用户的光标，我们通过 VSCode 的 API 获取了实时光标位置，通过自己绘制假的光标实现了实时同步各个用户的光标，不同用户的光标颜色不同。
- 值得一提的是，VSCode 支持多光标操作，我们的插件也支持多光标同步编辑。

<!-- slide -->
## `undo` 与 `redo`
- Automerge 自带的 undo 是将本客户端的某次操作和上次操作之间的所有操作全部撤销，而我们理解的 undo 是回退到 doc 的上一个版本，所以我们重写了它的 undo 方法。
- 每当 undo 的时候，用户给服务器发送请求，使所有客户端同时回退到上一个版本。
- 对于 redo ，我们维护了一个 undo 栈，redo 就是回退到 undo 之前的版本并退栈。

<!-- slide -->
## 服务端
- C/S 架构：VSCode Extension - LSP - server
- 分布式：文本协作的处理完成于客户端（LSP），不依赖 server
- 功能：认证鉴权，消息广播

<!-- slide -->
## 架构图
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="522px" viewBox="-0.5 -0.5 522 683" content="&lt;mxfile host=&quot;d2915f48-7dd1-4c04-8594-2b11e65fc02e&quot; modified=&quot;2020-07-15T00:27:56.642Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&quot; etag=&quot;Dt5Umdl4Vkj3q8-tO8nR&quot; version=&quot;13.1.3&quot;&gt;&lt;diagram id=&quot;6hGFLwfOUW9BJ-s0fimq&quot; name=&quot;Page-1&quot;&gt;&lt;mxGraphModel dx=&quot;756&quot; dy=&quot;432&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;mxCell id=&quot;9&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;6&quot; target=&quot;11&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;Array as=&quot;points&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;2&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;180&quot; y=&quot;240&quot; width=&quot;400&quot; height=&quot;180&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;8&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;180&quot; y=&quot;500&quot; width=&quot;400&quot; height=&quot;180&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;7&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;5&quot; target=&quot;6&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;5&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;VSCode&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;221&quot; y=&quot;300&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;6&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Language Server&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;421&quot; y=&quot;300&quot; width=&quot;139&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;38&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;11&quot; target=&quot;33&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;Array as=&quot;points&quot;&gt;&lt;mxPoint x=&quot;491&quot; y=&quot;750&quot;/&gt;&lt;mxPoint x=&quot;491&quot; y=&quot;750&quot;/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;11&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0)&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Server&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;430.5&quot; y=&quot;560&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;12&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0) ; font-size: 15px&amp;quot;&amp;gt;Client&amp;lt;/b&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;580&quot; y=&quot;300&quot; width=&quot;110&quot; height=&quot;50&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;14&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0) ; font-size: 15px&amp;quot;&amp;gt;Server&amp;lt;/b&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;580&quot; y=&quot;565&quot; width=&quot;110&quot; height=&quot;50&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;30&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;180&quot; y=&quot;740&quot; width=&quot;410&quot; height=&quot;180&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;32&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;VSCode&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;231&quot; y=&quot;800&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;36&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;33&quot; target=&quot;32&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;33&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Language Server&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;431&quot; y=&quot;800&quot; width=&quot;139&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;34&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0) ; font-size: 15px&amp;quot;&amp;gt;Client&amp;lt;/b&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;590&quot; y=&quot;800&quot; width=&quot;110&quot; height=&quot;50&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:683px;"><defs/><g><path d="M 311.5 121 L 311.5 310.9" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 311.5 317.65 L 307 308.65 L 311.5 310.9 L 316 308.65 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="1" y="1" width="400" height="180" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><rect x="1" y="261" width="400" height="180" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><path d="M 162 91 L 231.9 91" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 238.65 91 L 229.65 95.5 L 231.9 91 L 229.65 86.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="42" y="61" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 91px; margin-left: 43px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>VSCode</b></font></div></div></div></foreignObject><text x="102" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">VSCode</text></switch></g><rect x="242" y="61" width="139" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 137px; height: 1px; padding-top: 91px; margin-left: 243px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px" color="#000000"><b>Language Server</b></font></div></div></div></foreignObject><text x="312" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Language Server</text></switch></g><path d="M 311.5 381 L 311.5 511 L 311.5 550.9" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 311.5 557.65 L 307 548.65 L 311.5 550.9 L 316 548.65 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="251.5" y="321" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 351px; margin-left: 253px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0)"><font style="font-size: 18px">Server</font></b></div></div></div></foreignObject><text x="312" y="355" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Server</text></switch></g><rect x="401" y="61" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 86px; margin-left: 402px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0) ; font-size: 15px">Client</b></div></div></div></foreignObject><text x="456" y="90" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g><rect x="401" y="326" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 351px; margin-left: 402px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0) ; font-size: 15px">Server</b></div></div></div></foreignObject><text x="456" y="355" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Server</text></switch></g><rect x="1" y="501" width="410" height="180" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><rect x="52" y="561" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 591px; margin-left: 53px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>VSCode</b></font></div></div></div></foreignObject><text x="112" y="595" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">VSCode</text></switch></g><path d="M 252 591 L 182.1 591" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 175.35 591 L 184.35 586.5 L 182.1 591 L 184.35 595.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="252" y="561" width="139" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 137px; height: 1px; padding-top: 591px; margin-left: 253px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px" color="#000000"><b>Language Server</b></font></div></div></div></foreignObject><text x="322" y="595" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Language Server</text></switch></g><rect x="411" y="561" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 586px; margin-left: 412px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0) ; font-size: 15px">Client</b></div></div></div></foreignObject><text x="466" y="590" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>

<!-- slide -->
## 现有的文本协作系统
- VSCode LiveShare：未开源，本地双客户端测试 -> 中心式
- Microsoft Office，Google doc……：本地仅做展示 -> 中心式
- Git：分布式版本管理系统，几乎不具实时性

<!-- slide -->
## 实现方案
### 中心化的 `colive-server`
- 单一的服务端，所有客户端（LSP）连接到 server 。
- 消息广播由服务端负责。
- 优点：简单易实现、易维护，一致性好，便于追踪用户状态。
- 缺点：单服务器有并发的性能瓶颈，客户端服务端间的网络质量。

<!-- slide -->
### 分布式的 `distributed-middleware`
- 单一的服务端仅作认证鉴权，所有客户端（LSP）连接到本地增开的中间件
- 中间件拥有本地地址，将认证鉴权传至 server，将消息直接广播给各客户端
- 架构：VSCode Extension - LSP - middleware - server
<!-- slide -->
## 架构图
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="752px" viewBox="-0.5 -0.5 752 683" content="&lt;mxfile host=&quot;af87f198-8102-4bcc-9445-c709a7eeeecc&quot; modified=&quot;2020-07-15T00:32:22.037Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&quot; etag=&quot;DseuKGXdMhZg8RSpmcuF&quot; version=&quot;13.1.3&quot;&gt;&lt;diagram id=&quot;6hGFLwfOUW9BJ-s0fimq&quot; name=&quot;Page-1&quot;&gt;&lt;mxGraphModel dx=&quot;766&quot; dy=&quot;864&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;mxCell id=&quot;2&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;70&quot; y=&quot;430&quot; width=&quot;610&quot; height=&quot;180&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;8&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;70&quot; y=&quot;690&quot; width=&quot;610&quot; height=&quot;180&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;7&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;5&quot; target=&quot;6&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;5&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;VSCode&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;111&quot; y=&quot;490&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;48&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;6&quot; target=&quot;42&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;530&quot; y=&quot;520&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;6&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Language Server&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;311&quot; y=&quot;490&quot; width=&quot;139&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;11&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0)&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Auth Server&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;540&quot; y=&quot;760&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;12&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0)&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Client&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;700&quot; y=&quot;490&quot; width=&quot;110&quot; height=&quot;50&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;14&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0)&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Server&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;710&quot; y=&quot;770&quot; width=&quot;110&quot; height=&quot;50&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;30&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;80&quot; y=&quot;930&quot; width=&quot;600&quot; height=&quot;180&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;32&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;VSCode&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;121&quot; y=&quot;990&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;36&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;33&quot; target=&quot;32&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;33&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Language Server&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;321&quot; y=&quot;990&quot; width=&quot;139&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;34&quot; value=&quot;&amp;lt;b style=&amp;quot;color: rgb(0 , 0 , 0)&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Client&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;700&quot; y=&quot;1010&quot; width=&quot;110&quot; height=&quot;50&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;53&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeColor=#000000;strokeWidth=3;entryX=1;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;42&quot; target=&quot;55&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;790&quot; y=&quot;1000&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;&gt;&lt;mxPoint x=&quot;720&quot; y=&quot;520&quot;/&gt;&lt;mxPoint x=&quot;720&quot; y=&quot;1020&quot;/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;58&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;message&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;53&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;-0.3029&quot; y=&quot;3&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint y=&quot;-1&quot; as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;42&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;MiddleWare&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;540&quot; y=&quot;490&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;50&quot; value=&quot;&quot; style=&quot;endArrow=classic;startArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;11&quot; target=&quot;42&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;450&quot; y=&quot;710&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;590&quot; y=&quot;640&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;51&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Auth&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;50&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;0.2095&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;57&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;entryX=1;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;55&quot; target=&quot;33&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;469.9999999999998&quot; y=&quot;1020&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;55&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;MiddleWare&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;550&quot; y=&quot;990&quot; width=&quot;110&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;59&quot; value=&quot;&quot; style=&quot;endArrow=classic;startArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;599&quot; y=&quot;990&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;599&quot; y=&quot;820&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;60&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Auth&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;59&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;0.2095&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:683px;"><defs/><g><rect x="1" y="1" width="610" height="180" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><rect x="1" y="261" width="610" height="180" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><path d="M 162 91 L 231.9 91" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 238.65 91 L 229.65 95.5 L 231.9 91 L 229.65 86.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="42" y="61" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 91px; margin-left: 43px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>VSCode</b></font></div></div></div></foreignObject><text x="102" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">VSCode</text></switch></g><path d="M 381 91 L 460.9 91" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 467.65 91 L 458.65 95.5 L 460.9 91 L 458.65 86.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="242" y="61" width="139" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 137px; height: 1px; padding-top: 91px; margin-left: 243px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px" color="#000000"><b>Language Server</b></font></div></div></div></foreignObject><text x="312" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Language Server</text></switch></g><rect x="471" y="331" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 361px; margin-left: 472px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0)"><font style="font-size: 18px">Auth Server</font></b></div></div></div></foreignObject><text x="531" y="365" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Auth Server</text></switch></g><rect x="631" y="61" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 86px; margin-left: 632px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0)"><font style="font-size: 18px">Client</font></b></div></div></div></foreignObject><text x="686" y="90" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g><rect x="641" y="341" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 366px; margin-left: 642px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0)"><font style="font-size: 18px">Server</font></b></div></div></div></foreignObject><text x="696" y="370" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Server</text></switch></g><rect x="11" y="501" width="600" height="180" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><rect x="52" y="561" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 591px; margin-left: 53px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>VSCode</b></font></div></div></div></foreignObject><text x="112" y="595" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">VSCode</text></switch></g><path d="M 252 591 L 182.1 591" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 175.35 591 L 184.35 586.5 L 182.1 591 L 184.35 595.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="252" y="561" width="139" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 137px; height: 1px; padding-top: 591px; margin-left: 253px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px" color="#000000"><b>Language Server</b></font></div></div></div></foreignObject><text x="322" y="595" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Language Server</text></switch></g><rect x="631" y="581" width="110" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 606px; margin-left: 632px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b style="color: rgb(0 , 0 , 0)"><font style="font-size: 18px">Client</font></b></div></div></div></foreignObject><text x="686" y="610" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g><path d="M 591 91 L 651 91 L 651 591 L 601.1 591" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 594.35 591 L 603.35 586.5 L 601.1 591 L 603.35 595.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 247px; margin-left: 655px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font color="#000000" style="font-size: 18px">message</font></b></div></div></div></foreignObject><text x="655" y="250" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">message</text></switch></g><rect x="471" y="61" width="120" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 91px; margin-left: 472px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>MiddleWare</b></font></div></div></div></foreignObject><text x="531" y="95" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">MiddleWare</text></switch></g><path d="M 531 320.9 L 531 131.1" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 531 327.65 L 526.5 318.65 L 531 320.9 L 535.5 318.65 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><path d="M 531 124.35 L 535.5 133.35 L 531 131.1 L 526.5 133.35 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 206px; margin-left: 533px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font color="#000000" style="font-size: 18px">Auth</font></b></div></div></div></foreignObject><text x="533" y="209" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Auth</text></switch></g><path d="M 481 591 L 401.1 591" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 394.35 591 L 403.35 586.5 L 401.1 591 L 403.35 595.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="481" y="561" width="110" height="60" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 591px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>MiddleWare</b></font></div></div></div></foreignObject><text x="536" y="595" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">MiddleWare</text></switch></g><path d="M 530 550.9 L 530 401.1" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 530 557.65 L 525.5 548.65 L 530 550.9 L 534.5 548.65 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><path d="M 530 394.35 L 534.5 403.35 L 530 401.1 L 525.5 403.35 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 460px; margin-left: 532px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font color="#000000" style="font-size: 18px">Auth</font></b></div></div></div></foreignObject><text x="532" y="463" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Auth</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>
<!-- slide -->
## 事务流程图
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="813px" viewBox="-0.5 -0.5 813 563" content="&lt;mxfile host=&quot;bc00cda0-95cb-4275-8d47-149d44ec5531&quot; modified=&quot;2020-07-15T00:33:57.777Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&quot; etag=&quot;Xdtx-kXQ-lVjwF7VSjiU&quot; version=&quot;13.1.3&quot;&gt;&lt;diagram id=&quot;6hGFLwfOUW9BJ-s0fimq&quot; name=&quot;Page-1&quot;&gt;&lt;mxGraphModel dx=&quot;383&quot; dy=&quot;432&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;mxCell id=&quot;64&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#000000;entryX=0;entryY=0;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;200&quot; y=&quot;240&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;360&quot; y=&quot;240&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;&gt;&lt;mxPoint x=&quot;280&quot; y=&quot;241&quot;/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;73&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;①&amp;lt;/font&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;connect&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;64&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;0.3333&quot; y=&quot;-30&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;-23&quot; y=&quot;-30.11&quot; as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;65&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#000000;strokeWidth=3;entryX=0;entryY=0.333;entryDx=0;entryDy=0;entryPerimeter=0;&quot; parent=&quot;1&quot; target=&quot;61&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;200&quot; y=&quot;270&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;340&quot; y=&quot;270&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;74&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;③&amp;lt;/font&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;login&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;65&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;0.3204&quot; y=&quot;2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;-22.34&quot; y=&quot;2&quot; as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;60&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Language Server&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;10&quot; y=&quot;220&quot; width=&quot;190&quot; height=&quot;150&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;61&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;MiddleWare&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;360&quot; y=&quot;220&quot; width=&quot;180&quot; height=&quot;150&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;82&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;Auth Server&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;640&quot; y=&quot;90&quot; width=&quot;180&quot; height=&quot;140&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;84&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=1.003;exitY=0.116;exitDx=0;exitDy=0;entryX=-0.004;entryY=0.159;entryDx=0;entryDy=0;exitPerimeter=0;entryPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;61&quot; target=&quot;82&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;480&quot; y=&quot;290&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;530&quot; y=&quot;240&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;87&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;②connect&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];rotation=-50;&quot; parent=&quot;84&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;-0.1865&quot; y=&quot;2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;85&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;61&quot; target=&quot;82&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;520&quot; y=&quot;340&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;570&quot; y=&quot;290&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;92&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;④&amp;lt;/font&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot;&amp;gt;login&amp;lt;/font&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];rotation=-50;fontSize=13;&quot; parent=&quot;85&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;-0.1918&quot; y=&quot;2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;86&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;entryX=1;entryY=0.75;entryDx=0;entryDy=0;exitX=0.006;exitY=0.865;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;82&quot; target=&quot;61&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;590&quot; y=&quot;270&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;640&quot; y=&quot;220&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;94&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;⑤client list&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];rotation=-50;fontSize=13;&quot; parent=&quot;86&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;0.0974&quot; y=&quot;1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;3.61&quot; y=&quot;-8.34&quot; as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;95&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;61&quot; target=&quot;60&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;361.596&quot; y=&quot;304.58000000000004&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;219.01999999999998&quot; y=&quot;303.94999999999993&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;97&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;⑦login OK&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;95&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;0.076&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;7.9&quot; as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;100&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;fontSize=13;entryX=0;entryY=0.75;entryDx=0;entryDy=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;60&quot; target=&quot;61&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;201&quot; y=&quot;355&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;347&quot; y=&quot;352&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;101&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;⑧message&amp;lt;/font&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontStyle=1&quot; parent=&quot;100&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;-0.1224&quot; y=&quot;-2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;103&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;MiddleWare&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;620&quot; y=&quot;518&quot; width=&quot;160&quot; height=&quot;132&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;106&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;fontSize=11;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;61&quot; target=&quot;103&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;390&quot; y=&quot;440&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;440&quot; y=&quot;390&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;108&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;⑥connect&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;rotation=55;&quot; parent=&quot;106&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;-0.2513&quot; y=&quot;1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;107&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;fontSize=11;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;61&quot; target=&quot;103&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;360&quot; y=&quot;430&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;410&quot; y=&quot;380&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;109&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;⑨message&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;rotation=55;&quot; parent=&quot;107&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&lt;mxGeometry x=&quot;-0.2451&quot; y=&quot;-2&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint as=&quot;offset&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:563px;"><defs/><g><path d="M 191 151 L 191 152 L 271 152 L 271 151 L 340.9 151" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 347.65 151 L 338.65 155.5 L 340.9 151 L 338.65 146.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 151px; margin-left: 275px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><font style="font-size: 18px"><b><font color="#000000">①</font><font color="#000000">connect</font></b></font></div></div></div></foreignObject><text x="275" y="155" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">①connect</text></switch></g><path d="M 191 181 L 340.9 180.95" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 347.65 180.95 L 338.65 185.45 L 340.9 180.95 L 338.64 176.45 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 181px; margin-left: 275px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><font style="font-size: 18px"><b><font color="#000000">③</font><font color="#000000">login</font></b></font></div></div></div></foreignObject><text x="275" y="185" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">③login</text></switch></g><rect x="1" y="131" width="190" height="150" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 188px; height: 1px; padding-top: 206px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b><font color="#000000" style="font-size: 18px">Language Server</font></b></div></div></div></foreignObject><text x="96" y="210" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Language Server</text></switch></g><rect x="351" y="131" width="180" height="150" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 206px; margin-left: 352px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b><font color="#000000" style="font-size: 18px">MiddleWare</font></b></div></div></div></foreignObject><text x="441" y="210" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">MiddleWare</text></switch></g><rect x="631" y="1" width="180" height="140" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 71px; margin-left: 632px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b><font color="#000000" style="font-size: 18px">Auth Server</font></b></div></div></div></foreignObject><text x="721" y="75" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Auth Server</text></switch></g><path d="M 531.54 148.4 L 624.02 31.19" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 628.2 25.89 L 626.16 35.75 L 624.02 31.19 L 619.09 30.17 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-50 570.937443806392 96.07127293397116)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 96px; margin-left: 571px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font color="#000000" style="font-size: 18px">②connect</font></b></div></div></div></foreignObject><text x="571" y="99" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">②connect</text></switch></g><path d="M 531 206 L 624.99 79.12" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 629 73.7 L 627.26 83.61 L 624.99 79.12 L 620.03 78.25 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-50 570.5727750822634 150.1060273345896)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 150px; margin-left: 571px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font style="font-size: 18px"><font color="#000000">④</font><font color="#000000">login</font></font></b></div></div></div></foreignObject><text x="571" y="154" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">④login</text></switch></g><path d="M 632.08 122.1 L 537.47 235.74" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 533.15 240.92 L 535.45 231.13 L 537.47 235.74 L 542.36 236.89 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-50 581.4950377532639 181.19695131073297)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 181px; margin-left: 581px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><font color="#000000" style="font-size: 18px"><b>⑤client list</b></font></div></div></div></foreignObject><text x="581" y="185" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">⑤client list</text></switch></g><path d="M 351 206 L 201.1 206" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 194.35 206 L 203.35 201.5 L 201.1 206 L 203.35 210.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 206px; margin-left: 273px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font color="#000000" style="font-size: 18px">⑦login OK</font></b></div></div></div></foreignObject><text x="273" y="209" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">⑦login OK</text></switch></g><path d="M 191 243.5 L 340.9 243.5" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 347.65 243.5 L 338.65 248 L 340.9 243.5 L 338.65 239 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 246px; margin-left: 262px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; font-weight: bold; background-color: #ffffff; white-space: nowrap; "><font color="#000000" style="font-size: 18px">⑧message</font></div></div></div></foreignObject><text x="262" y="249" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle" font-weight="bold">⑧message</text></switch></g><rect x="611" y="429" width="160" height="132" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 158px; height: 1px; padding-top: 495px; margin-left: 612px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b><font color="#000000" style="font-size: 18px">MiddleWare</font></b></div></div></div></foreignObject><text x="691" y="499" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">MiddleWare</text></switch></g><path d="M 486 281 L 605.26 453.69" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 609.09 459.24 L 600.28 454.39 L 605.26 453.69 L 607.68 449.28 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(55 533.2977073917751 348.601495847622)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 349px; margin-left: 533px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><font style="font-size: 18px" color="#000000"><b>⑥connect</b></font></div></div></div></foreignObject><text x="533" y="352" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">⑥connect</text></switch></g><path d="M 441 281 L 605.27 519.68" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 609.1 525.24 L 600.29 520.37 L 605.27 519.68 L 607.7 515.27 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(55 503.2954427265714 375.91400854029337)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 376px; margin-left: 503px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><b><font color="#000000" style="font-size: 18px">⑨message</font></b></div></div></div></foreignObject><text x="503" y="379" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">⑨message</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>
<!-- slide -->
### 分布式的 `distributed-middleware`
- 优点：利用优质的客户端资源，大大减轻服务端压力，节省开销，适应大用户量的情况，隐私安全
- 缺点：客户端条件限制（NAT，端口封锁），客户端间的连接状况

<!-- slide -->
## 可行的改进
### 中心化的区域子服务器
- 在某一个合适的子区域内，设置子服务器，客户端连接到子服务器，子服务器间广播消息，主服务器做认证鉴权
- 调节中心式和分布式的比例，适应实际的环境

<!-- slide -->
## 架构图
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="752px" viewBox="-0.5 -0.5 752 873" content="&lt;mxfile host=&quot;cd0f4a7d-144e-4155-bc4c-c619a1b9a590&quot; modified=&quot;2020-07-15T00:35:46.703Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&quot; etag=&quot;3dGen9yiaBugM9ZtGUfU&quot; version=&quot;13.1.3&quot;&gt;&lt;diagram id=&quot;6hGFLwfOUW9BJ-s0fimq&quot; name=&quot;Page-1&quot;&gt;&lt;mxGraphModel dx=&quot;638&quot; dy=&quot;720&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;mxCell id=&quot;110&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 30px&amp;quot;&amp;gt;Client&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;260&quot; y=&quot;200&quot; width=&quot;280&quot; height=&quot;120&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;112&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;entryX=0.073;entryY=1.016;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; target=&quot;110&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;181&quot; y=&quot;497&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;283.9599999999999&quot; y=&quot;330&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;113&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;entryX=0.116;entryY=1.051;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;294&quot; y=&quot;505&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;296.48&quot; y=&quot;321.12&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;114&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;entryX=0.191;entryY=1.012;entryDx=0;entryDy=0;entryPerimeter=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; target=&quot;110&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;360&quot; y=&quot;490&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;302.96000000000004&quot; y=&quot;342.9999999999999&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;115&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;110&quot; y=&quot;483&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;116&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;242&quot; y=&quot;504&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;117&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;340&quot; y=&quot;483&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;118&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;90&quot; y=&quot;470&quot; width=&quot;370&quot; height=&quot;120&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;119&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Slave Server&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;222&quot; y=&quot;729&quot; width=&quot;128&quot; height=&quot;70&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;124&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.25;exitY=0;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;119&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;253&quot; y=&quot;738&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;145&quot; y=&quot;563&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;125&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=0;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;119&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;340&quot; y=&quot;747&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;250&quot; y=&quot;570&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;126&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.75;exitY=0;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;119&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;480&quot; y=&quot;740&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;373&quot; y=&quot;563&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;127&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.909;exitY=1.012;exitDx=0;exitDy=0;exitPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;110&quot; target=&quot;136&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;530&quot; y=&quot;400&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;780&quot; y=&quot;460&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;128&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;110&quot; target=&quot;135&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;450&quot; y=&quot;380&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;670&quot; y=&quot;470&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;131&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.642;exitY=1.005;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;110&quot; target=&quot;134&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;400&quot; y=&quot;390&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;580&quot; y=&quot;470&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;132&quot; value=&quot;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;dashed=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;480&quot; y=&quot;465&quot; width=&quot;330&quot; height=&quot;120&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;134&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;540&quot; y=&quot;490&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;135&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;630&quot; y=&quot;490&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;136&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;720&quot; y=&quot;485&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;137&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;134&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;580&quot; y=&quot;730&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;610&quot; y=&quot;730&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;138&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;135&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;660&quot; y=&quot;565&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;660&quot; y=&quot;730&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;139&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;745&quot; y=&quot;560&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;710&quot; y=&quot;730&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;140&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px&amp;quot; color=&amp;quot;#000000&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Slave Server&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;585&quot; y=&quot;730&quot; width=&quot;135&quot; height=&quot;70&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;143&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;119&quot; target=&quot;145&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;250&quot; y=&quot;920&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;400&quot; y=&quot;990&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;144&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=0.75;exitY=0;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;145&quot; target=&quot;140&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;510&quot; y=&quot;980&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;660&quot; y=&quot;860&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;145&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Main Server&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;380&quot; y=&quot;1000&quot; width=&quot;130&quot; height=&quot;70&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;146&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;子网 A&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;70&quot; y=&quot;435&quot; width=&quot;70&quot; height=&quot;30&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;147&quot; value=&quot;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 18px&amp;quot;&amp;gt;&amp;lt;b&amp;gt;子网 B&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;740&quot; y=&quot;440&quot; width=&quot;80&quot; height=&quot;20&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:873px;"><defs/><g><rect x="190" y="1" width="280" height="120" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 61px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b><font color="#000000" style="font-size: 30px">Client</font></b></div></div></div></foreignObject><text x="330" y="65" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g><path d="M 111 298 L 210.44 122.92" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 224 306 L 226.48 122.12" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 290 291 L 243.48 122.44" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="80" cy="324" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><ellipse cx="212" cy="345" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><ellipse cx="310" cy="324" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><rect x="20" y="271" width="370" height="120" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><rect x="152" y="530" width="128" height="70" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 126px; height: 1px; padding-top: 565px; margin-left: 153px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px" color="#000000"><b>Slave Server </b></font></div></div></div></foreignObject><text x="216" y="569" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Slave Server </text></switch></g><path d="M 184 530 L 75 364" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 216 530 L 180 371" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 248 530 L 303 364" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 444.52 122.44 L 659.22 300.45" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 400 121 L 571.72 302.72" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 369.76 121.6 L 481.72 302.72" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><rect x="410" y="266" width="330" height="120" fill="none" stroke="#000000" stroke-width="3" stroke-dasharray="9 9" pointer-events="all"/><ellipse cx="510" cy="331" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><ellipse cx="600" cy="331" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><ellipse cx="690" cy="326" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><path d="M 510 371 L 540 531" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 600 371 L 590 531" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 675 361 L 640 531" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><rect x="515" y="531" width="135" height="70" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 133px; height: 1px; padding-top: 566px; margin-left: 516px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px" color="#000000"><b>Slave Server </b></font></div></div></div></foreignObject><text x="583" y="570" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Slave Server </text></switch></g><path d="M 216 600 L 342.5 801" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 407.5 801 L 582.5 601" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><rect x="310" y="801" width="130" height="70" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 836px; margin-left: 311px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>Main Server</b></font></div></div></div></foreignObject><text x="375" y="840" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Main Server</text></switch></g><rect x="0" y="236" width="70" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 251px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>子网 A</b></font></div></div></div></foreignObject><text x="35" y="255" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">子网 A</text></switch></g><rect x="670" y="241" width="80" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 251px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font color="#000000" style="font-size: 18px"><b>子网 B</b></font></div></div></div></foreignObject><text x="710" y="255" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">子网 B</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>
<!-- slide -->
### 客户端可作中继

- 客户端间并不直接两两相连，而是借助各客户端组建一条最优线路，在此线路上进行通信，P2P
- 例如所有客户端广播出一个包，各客户端将接受的包广播给未接受过此包的人，从接受的包中按不同始发包人取最先到达的包（历遍，协作人数不会太多）
- 优化连接，充分利用客户端资源


<!-- slide -->
## 架构图
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="483px" viewBox="-0.5 -0.5 483 593" content="&lt;mxfile host=&quot;16f74b43-db02-4736-b007-a78dabc273c0&quot; modified=&quot;2020-07-14T15:49:17.360Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&quot; etag=&quot;GX146bt-g9rewt2Qk_H-&quot; version=&quot;13.1.3&quot;&gt;&lt;diagram id=&quot;6hGFLwfOUW9BJ-s0fimq&quot; name=&quot;Page-1&quot;&gt;&lt;mxGraphModel dx=&quot;461&quot; dy=&quot;432&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;mxCell id=&quot;110&quot; value=&quot;&amp;lt;b&amp;gt;&amp;lt;font color=&amp;quot;#000000&amp;quot; style=&amp;quot;font-size: 30px&amp;quot;&amp;gt;Client&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;260&quot; y=&quot;200&quot; width=&quot;280&quot; height=&quot;120&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;147&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeWidth=3;strokeColor=#000000;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;160&quot; y=&quot;460&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;148&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;270&quot; y=&quot;460&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;149&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;550&quot; y=&quot;460&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;150&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;147&quot; target=&quot;110&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;300&quot; y=&quot;390&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;350&quot; y=&quot;340&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;151&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=3;strokeColor=#000000;&quot; parent=&quot;1&quot; source=&quot;148&quot; target=&quot;110&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;370&quot; y=&quot;390&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;420&quot; y=&quot;340&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;152&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;entryX=0.75;entryY=1;entryDx=0;entryDy=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeColor=#000000;strokeWidth=3;&quot; parent=&quot;1&quot; source=&quot;149&quot; target=&quot;110&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;480&quot; y=&quot;370&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;530&quot; y=&quot;320&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;154&quot; value=&quot;&quot; style=&quot;endArrow=none;html=1;strokeColor=#000000;strokeWidth=3;exitX=0;exitY=0;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;155&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;480&quot; y=&quot;480&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;433&quot; y=&quot;320&quot; as=&quot;targetPoint&quot;/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;155&quot; value=&quot;&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#000000;strokeWidth=3;fillColor=none;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;430&quot; y=&quot;460&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;156&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#6F0000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;fillColor=#a20025;&quot; parent=&quot;1&quot; source=&quot;149&quot; target=&quot;155&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;480&quot; y=&quot;660&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;530&quot; y=&quot;610&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;&gt;&lt;mxPoint x=&quot;590&quot; y=&quot;620&quot;/&gt;&lt;mxPoint x=&quot;470&quot; y=&quot;620&quot;/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;157&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#6F0000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;edgeStyle=orthogonalEdgeStyle;entryX=0.5;entryY=1;entryDx=0;entryDy=0;curved=1;fillColor=#a20025;&quot; parent=&quot;1&quot; source=&quot;149&quot; target=&quot;148&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;370&quot; y=&quot;690&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;420&quot; y=&quot;640&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;&gt;&lt;mxPoint x=&quot;590&quot; y=&quot;680&quot;/&gt;&lt;mxPoint x=&quot;310&quot; y=&quot;680&quot;/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;mxCell id=&quot;158&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;strokeColor=#6F0000;strokeWidth=3;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fillColor=#a20025;&quot; parent=&quot;1&quot; target=&quot;147&quot; edge=&quot;1&quot;&gt;&lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&lt;mxPoint x=&quot;590&quot; y=&quot;540&quot; as=&quot;sourcePoint&quot;/&gt;&lt;mxPoint x=&quot;480&quot; y=&quot;790&quot; as=&quot;targetPoint&quot;/&gt;&lt;Array as=&quot;points&quot;&gt;&lt;mxPoint x=&quot;640&quot; y=&quot;540&quot;/&gt;&lt;mxPoint x=&quot;640&quot; y=&quot;790&quot;/&gt;&lt;mxPoint x=&quot;200&quot; y=&quot;790&quot;/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://app.diagrams.net/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:593px;"><defs/><g><rect x="101" y="1" width="280" height="120" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 61px; margin-left: 102px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><b><font color="#000000" style="font-size: 30px">Client</font></b></div></div></div></foreignObject><text x="241" y="65" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g><ellipse cx="41" cy="301" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><ellipse cx="151" cy="301" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><ellipse cx="431" cy="301" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><path d="M 41 261 L 171 121" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 151 261 L 241 121" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 431 261 L 311 121" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 282.72 272.72 L 274 121" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="311" cy="301" rx="40" ry="40" fill="none" stroke="#000000" stroke-width="3" pointer-events="all"/><path d="M 431 341 Q 431 421 371 421 Q 311 421 311 351.1" fill="none" stroke="#6f0000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 311 344.35 L 315.5 353.35 L 311 351.1 L 306.5 353.35 Z" fill="#6f0000" stroke="#6f0000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><path d="M 431 341 Q 431 481 291 481 Q 151 481 151 351.1" fill="none" stroke="#6f0000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 151 344.35 L 155.5 353.35 L 151 351.1 L 146.5 353.35 Z" fill="#6f0000" stroke="#6f0000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><path d="M 431 341 Q 481 341 481 466 Q 481 591 261 591 Q 41 591 41 351.1" fill="none" stroke="#6f0000" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41 344.35 L 45.5 353.35 L 41 351.1 L 36.5 353.35 Z" fill="#6f0000" stroke="#6f0000" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>
<!-- slide -->

## 现场演示
此处应有现场演示

<!-- slide -->
## 创新点
- 优化服务端架构，提高内网中操作的并发性。
- 客户端添加 language server 层，分离文本编辑器本身和与服务器交互的部分。
- 采用成熟的文本编辑器插件，可以利用其自动补全等语言特性，有利于处理不同格式的文本。

<!-- slide -->
## 展望
- 针对更复杂数据结构的分布式协作。
- 如何更好的处理 CRDT 中的包含关系带来的不一致。
- 优化并发性。

<!-- slide -->
# Q & A

<!-- slide -->
## 致谢
感谢邢凯老师的指导和同学们的支持。